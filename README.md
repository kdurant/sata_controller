本文所有SATA资料资料参考文档`Serial ATA International Organization: Serial ATA Revision 3.0`
# 信号描述
## ALIGNp Primitive
链路层应该忽视接受ALIGNp原语。物理层自由的使用接受到的原语.Phy不消耗接收到的ALIGNP原语的实现应该在链路层的输入处有效地丢弃接收的ALIGNP原语，或者应该包括链路层处理，其产生与如果所有接收到的ALIGNP原语被Phy消耗且没有被呈现链接。
# OOB
OOB信号有3个，分别是COMRESET、COMINIT和COMWAKE，其中COMRESET与COMINIT信号组成形式一样，只不过CONRESET由主机发出，而COMINIT由设备发出，它们的作用是在正常的通信链路没有建立之前主机进行SATA设备识别。

## COMRESET
COMRESET始终来自主机控制器，并强制设备进行硬件复位。它通过总线空闲的情况下传输分开的突发数据来指示。

COMRESET信号由不少于6个数据的突发，包括内部的时间间隔

COMMRESET信号应该：
1. 只要系统处于复位状态，COMRESET需要一直持续
2. 在系统硬件复位期间启动，并在系统硬件复位否决后一段时间结束
3. 在系统硬件复位信号否定之后立即传输

主机控制器应忽略从接受硬件复位信号之前接收到的任何信号，直到发送COMRESET信号。

每个突发应为160个Gen1 UI单位（106.7 ns），每个突发间空闲状态为480个Gen1 UI单位（320 ns）。 COMRESET探测器寻找四个连续脉冲间隔320ns（标称）。

任何小于175 ns或大于525 ns的间隔都将使COMRESET检测器输出无效。到PHY层的COMRESET接口信号将启动下面图所示的复位序列。
在最后一次突发之后，接口应保持非激活状态至少525 ns，以确保远端检测器正确检测到否定。


描述：
1. 主机/设备通过某种形式的主动通信供电并正常运行
2. 主机中的一些条件导致主机发出COMRESET
3. 主机释放COMRESET。一旦有条件导致COMRESET被释放，主机释放COMRESET信号并使总线处于静止状态。
4. 设备发送COMINIT。当设备检测到COMRESET释放的时候，以COMINIT回应。当设备后启动的时候，这也是个入口点。设备可以在任何时候通过发送COMMIT发起通信
5. 主机校准并发出一个COMWAKE
6. 设备响应。设备检测RX引脚对上的COMWAKE序列并且校准收发器（可选）。在校准之后，设备发送一个六脉冲COMWAKE序列，然后以设备支持的最高速度发送一个连续的ALIGN序列流。在ALIGNP Dword被发送了54.6us（2048标称的Gen1双字时间）之后，如果没有从主机接收到的ALIGNP原语的检测来确定主机的响应，则设备假定主机不能以该速度通信。如果有更多的速度可用，设备将以这个速度发送ALIGNP双字，以54.6 us（2048标称Gen1双字时间）来尝试下一个较低的支持速度。
重复此步骤的速度与支持的速度相同。一旦达到最低速度而没有来自主机的响应，则设备进入错误状态。
7. 主机锁定 - 在检测到COMWAKE后，主机以最低的支持速度开始传输D10.2字符（见7.6）。同时，主机接收机锁定到ALIGN序列，准备就绪后，以接收的相同速度将ALIGN序列返回给设备。主机应设计成在任何给定的速度下获得54.6us（2048标称Gen1双字时间）的锁定。在检测到COMWAKE释放以接收第一个ALIGNP之后，主机应该允许至少873.8 us（32768标称Gen1双字时间）。这确保了与多代和同步设计的互操作性。如果在873.8 us之内没有收到ALIGNP（32768标称Gen1双字时间），主机将重新启动上电顺序 - 无限重复，直到被应用层告知停止。
8. 设备锁定 - 设备锁定到ALIGN序列，准备就绪后，发送SYNCP指示它已准备好开始正常操作。一旦收到三个背对背的非ALIGNP原语，通信链路就建立起来，并且可以开始正常的操作。
9. 一旦收到三个背对背的非ALIGNP原语，通信链路就建立起来，并且可以开始正常的操作。

## COMINIT
COMINIT始终来自设备并请求通信初始化。 它与COMRESET信号在电气上是相同的，除了它来源于设备并被发送到主机。 它被设备用来按照下图所示的顺序从主机请求重置。

描述：
1. 主机/设备通过某种形式的主动通信供电并正常运行
2. 设备中的某些条件会导致设备发出COMINIT命令
3. 主机校准并发送COMWAKE
4. 设备响应 - 设备检测到RX对上的COMWAKE序列并校准其发送器（可选）。在校准之后，设备发送一个六脉冲COMWAKE序列，然后以设备支持的最高速度发送一个连续的ALIGN序列流。 在ALIGNP Dword被发送了54.6us（2048标称的Gen1双字时间）之后，如果没有从主机接收到的ALIGNP原语的检测来确定主机的响应，则设备假定主机不能以那个速度进行通信。如果有额外的速度可用，设备将以这个速度发送ALIGNP Dword达到54.6 us（2048标称Gen1双字时间），从而尝试下一个较低的支持速度。这一步重复所支持的较慢的速度。一旦达到最低速度而没有来自主机的响应，则设备进入错误状态
5. 主机锁定 - 在检测到COMWAKE后，主机以最低的支持速度开始发送D10.2个字符（见7.6节）。同时，主机接收机锁定到ALIGN序列，准备就绪后，以接收的相同速度将ALIGN序列返回给设备。主机应该设计成在任何给定速度下获得54.6us（2048标称Gen1双字时间）的锁定。在检测到COMWAKE释放以接收第一个ALIGNP之后，主机应该允许至少873.8 us（32768标称Gen1双字时间）。这确保了与多代和同步设计的互操作性。如果在873.8 us之内没有收到ALIGNP（32768标称Gen1双字时间），主机将重新启动上电顺序 - 无限重复，直到被应用层告知停止。

6.设备锁定 - 设备锁定到ALIGN序列，准备就绪时，发送SYNCP指示它已准备好开始正常操作。
7.一旦收到三个背对背的非ALIGNP原语，通信链路就建立起来，并且可以开始正常的操作。

## COMWAKE
COMWAKE可能来自主机控制器或设备。 它通过发送由空闲总线条件分开的六个突发数据来发信号通知。OOB COMWAKE信令应包含不少于6个数据突发，包括突发间时间间隔。
每个突发应该是160个Gen1 UI长，每个突发间空闲状态应该是160个Gen1 UI长。

COMWAKE检波器以106.7 ns的间隔（标称值）寻找四个连续的脉冲串。

任何小于35 ns或大于175 ns的间距都应使COMWAKE检测器输出无效。

COMWAKE OOB信号用于使Phy离开掉电状态
（部分或睡眠），如8.1节所述。 在最后一次突发之后，接口应至少保持175ns的无效状态，以确保远端检测器正确检测到否定。

在COMWAKE结束时，器件应保持非激活状态不超过228.3 ns（175 ns +两个Gen1双字），以防止串扰。

# 分层
## 物理层
物理层负责设备识别和初始化，实现高速串行数据链路，在传输线上发送和接收已编码的串行数据流，对数据进行串并/并串转换，并从数据流中分离出时钟信息

## 链路层
链路层负责控制传输控制原语和数据，从数据帧中提取数据进行8B/10B编解码。同时，为保证数据可靠传输，链路层还引入CRC-32校验方式，并对数据进行加解扰

## 传输层
传输层位于链路层和应用层之间，负责处理控制信息，并将主机和设备之间需要交换的数据封装成数据帧，即帧信息结构FIS（Frame Information Structure）

## 应用层
应用层提供寄存器接口，并对所有ATA命令进行解析，完成寄存器的更新


# 环境
1. ISE 14.7
2. xc7k325T-2ffg900
3. Transceivers2.7

## Transceivers IP配置